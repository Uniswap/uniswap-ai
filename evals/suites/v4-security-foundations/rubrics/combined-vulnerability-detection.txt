# Combined Vulnerability Detection Rubric

Evaluate whether the response correctly identifies multiple vulnerabilities in the provided hook code and explains their interactions.

## Required Vulnerabilities to Identify

Score based on how many of these are correctly identified and explained:

1. **Missing PoolManager Verification (CRITICAL)**
   - Identifies that the hook lacks `onlyPoolManager` modifier
   - Explains anyone can call `afterSwap` directly to manipulate state
   - Correctly notes this is a CRITICAL severity issue

2. **Reentrancy Vulnerability (HIGH)**
   - Identifies the external call to `rewardToken.transfer()` before state update
   - Recognizes the CEI (Checks-Effects-Interactions) pattern violation
   - Notes that state update happens AFTER external call
   - Recommends ReentrancyGuard or CEI pattern fix

3. **Delta Accounting Mismatch (HIGH)**
   - Identifies that the hook calls `poolManager.take()` but returns delta of 0
   - Explains this will cause accounting errors or transaction revert
   - Provides correct fix: return the actual delta amount

4. **Wrong Recipient for Rewards (MEDIUM)**
   - Identifies that `msg.sender` in hook context is PoolManager, not the user
   - Explains rewards are sent to PoolManager instead of actual user
   - Recommends using `sender` parameter or decoding from hookData

5. **Unchecked Return Value (LOW)**
   - Notes that ERC20 transfer return value is not checked
   - Recommends using SafeERC20 or checking return value

## Vulnerability Chain Analysis

The response should also identify how vulnerabilities compound:
- Missing access control enables easier exploitation of other bugs
- Reentrancy + state manipulation = potential fund theft

## Scoring Guide

- 5/5 vulnerabilities + chain analysis: 1.0
- 4/5 vulnerabilities: 0.85
- 3/5 vulnerabilities: 0.7
- 2/5 vulnerabilities: 0.5
- 1/5 vulnerabilities: 0.3
- 0/5 vulnerabilities: 0.0

## Instructions

Evaluate whether the response demonstrates the ability to identify multiple co-existing vulnerabilities in a single codebase and understand how they interact. The response should provide actionable fixes for each issue.
