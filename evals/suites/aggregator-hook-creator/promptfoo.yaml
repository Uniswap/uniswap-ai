# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: 'Aggregator Hook Creator Skill Evaluation'

# Prompts (eval cases)
prompts:
  - file://cases/basic-aggregator-hook.md

# Provider configuration
# Uses default from root config, can override here for suite-specific models
providers:
  - id: file://../../scripts/anthropic-provider.ts:AnthropicProvider
    config:
      temperature: 0

# Default test configuration
defaultTest:
  options:
    timeout: 120000 # 2 minutes per case
  assert:
    # Security is non-negotiable for smart contracts
    - type: llm-rubric
      value: file://rubrics/security.md
      threshold: 1.0
      provider: file://../../scripts/anthropic-provider.ts:AnthropicProvider

# Test cases with specific assertions
tests:
  - vars:
      scenario: basic-aggregator-hook
    assert:
      # Correctness rubric
      - type: llm-rubric
        value: file://rubrics/correctness.md
        threshold: 0.8
        provider: file://../../scripts/anthropic-provider.ts:AnthropicProvider

      # Completeness rubric
      - type: llm-rubric
        value: file://rubrics/completeness.md
        threshold: 0.85
        provider: file://../../scripts/anthropic-provider.ts:AnthropicProvider

      # Deterministic checks for required patterns
      - type: contains
        value: 'BaseHook'
      - type: contains
        value: 'getHookPermissions'
      - type: contains
        value: 'beforeSwap'
      - type: contains
        value: 'afterSwap'

      # Should not contain security anti-patterns
      - type: not-contains
        value: 'selfdestruct'
      - type: not-contains
        value: 'delegatecall'
