# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: 'swap-integration Skill Evaluation'

# Prompts (eval cases)
prompts:
  - file://cases/basic.md
  - file://cases/eth-to-token-swap.md
  - file://cases/security-pitfalls.md
  - file://cases/smart-account-swap.md

# Provider configuration
providers:
  - id: anthropic:claude-sonnet-4-5-20250929
    config:
      temperature: 0
      max_tokens: 8192 # Swap integrations need more tokens for complete examples

# Default test configuration applied to all tests
defaultTest:
  options:
    timeout: 120000 # 2 minutes per case

# Test cases with specific assertions
tests:
  - vars:
      scenario: basic-trading-api-swap
    assert:
      # Correctness rubric
      - type: llm-rubric
        value: file://rubrics/correctness.txt
        threshold: 0.8
        provider: anthropic:claude-sonnet-4-5-20250929

      # Completeness rubric
      - type: llm-rubric
        value: file://rubrics/completeness.txt
        threshold: 0.85
        provider: anthropic:claude-sonnet-4-5-20250929

      # Deterministic checks for required patterns
      - type: contains
        value: 'trade-api.gateway.uniswap.org'
      - type: contains
        value: 'check_approval'
      - type: contains
        value: '/quote'
      - type: contains
        value: '/swap'

  - vars:
      scenario: eth-to-token-swap
    assert:
      # Correctness rubric
      - type: llm-rubric
        value: file://rubrics/correctness.txt
        threshold: 0.8
        provider: anthropic:claude-sonnet-4-5-20250929

      # Completeness rubric
      - type: llm-rubric
        value: file://rubrics/completeness.txt
        threshold: 0.85
        provider: anthropic:claude-sonnet-4-5-20250929

      # Deterministic checks for ETH-specific patterns
      - type: contains
        value: 'trade-api.gateway.uniswap.org'
      - type: contains
        value: '/quote'
      - type: contains
        value: '/swap'
      - type: contains
        value: 'value'
      - type: contains
        value: 'permitData'

      # Should not wrap quote in {quote: ...}
      - type: not-contains
        value: 'quote: quoteResponse'

  - vars:
      scenario: security-pitfalls
    assert:
      # Correctness rubric
      - type: llm-rubric
        value: file://rubrics/correctness.txt
        threshold: 0.8
        provider: anthropic:claude-sonnet-4-5-20250929

      # Completeness rubric
      - type: llm-rubric
        value: file://rubrics/completeness.txt
        threshold: 0.85
        provider: anthropic:claude-sonnet-4-5-20250929

      # Must include validation patterns
      - type: contains
        value: 'swap.data'
      - type: contains
        value: 'permitData'
      - type: contains
        value: 'signature'
      - type: contains
        value: 'isAddress'

      # Must strip null fields (destructuring pattern)
      - type: contains
        value: 'permitTransaction'

      # Must not include anti-patterns
      - type: not-contains
        value: 'permitData: null'
      - type: not-contains
        value: 'quote: quoteResponse'

  - vars:
      scenario: smart-account-swap
    assert:
      # Correctness rubric
      - type: llm-rubric
        value: file://rubrics/correctness.txt
        threshold: 0.8
        provider: anthropic:claude-sonnet-4-5-20250929

      # Completeness rubric
      - type: llm-rubric
        value: file://rubrics/completeness.txt
        threshold: 0.85
        provider: anthropic:claude-sonnet-4-5-20250929

      # Must include Trading API flow
      - type: contains
        value: 'trade-api.gateway.uniswap.org'

      # Must reference smart account / ERC-4337 patterns
      - type: contains
        value: 'sendUserOperation'

      # Must include WETH handling
      - type: contains
        value: 'withdraw'

      # Must use viem
      - type: contains
        value: 'viem'
